library(tmctools)

dtm_fle <- system.file("testdata", "box.dtm", package = "tmctools")
testDF <- readDTM(dtm_fle)
testEWKT <- readDTM(dtm_fle, srid = "3125")

test_that("readDTM works", {
  expect_equal(round(testDF$edge_length, digits = 2), rep(141.42, times = 12))
  expect_equal(
    testDF$polygon,
    c("POLYGON Z ((0.000 0.000 0.000,0.000 100.000 100.000,0.000 0.000 100.000,0.000 0.000 0.000))",
      "POLYGON Z ((0.000 0.000 0.000,0.000 100.000 0.000,0.000 100.000 100.000,0.000 0.000 0.000))",
      "POLYGON Z ((0.000 100.000 0.000,100.000 100.000 100.000,0.000 100.000 100.000,0.000 100.000 0.000))",
      "POLYGON Z ((0.000 100.000 0.000,100.000 100.000 0.000,100.000 100.000 100.000,0.000 100.000 0.000))",
      "POLYGON Z ((100.000 100.000 0.000,100.000 0.000 0.000,100.000 100.000 100.000,100.000 100.000 0.000))",
      "POLYGON Z ((100.000 0.000 0.000,100.000 0.000 100.000,100.000 100.000 100.000,100.000 0.000 0.000))",
      "POLYGON Z ((100.000 0.000 0.000,0.000 0.000 0.000,100.000 0.000 100.000,100.000 0.000 0.000))",
      "POLYGON Z ((0.000 0.000 0.000,0.000 0.000 100.000,100.000 0.000 100.000,0.000 0.000 0.000))",
      "POLYGON Z ((0.000 100.000 0.000,0.000 0.000 0.000,100.000 0.000 0.000,0.000 100.000 0.000))",
      "POLYGON Z ((0.000 100.000 0.000,100.000 0.000 0.000,100.000 100.000 0.000,0.000 100.000 0.000))",
      "POLYGON Z ((100.000 0.000 100.000,0.000 0.000 100.000,0.000 100.000 100.000,100.000 0.000 100.000))",
      "POLYGON Z ((100.000 100.000 100.000,100.000 0.000 100.000,0.000 100.000 100.000,100.000 100.000 100.000))")
  )
  expect_equal(
    round(testDF$slope_angle, digits = 2),
    c(rep(1.57, times = 8), 0, 0, 0, 0)
  )
  expect_equal(round(testEWKT$edge_length, digits = 2), rep(141.42, times = 12))
  expect_equal(
    testEWKT$polygon,
    c("SRID=3125;POLYGON((0.000 0.000 0.000,0.000 100.000 100.000,0.000 0.000 100.000,0.000 0.000 0.000))",
      "SRID=3125;POLYGON((0.000 0.000 0.000,0.000 100.000 0.000,0.000 100.000 100.000,0.000 0.000 0.000))",
      "SRID=3125;POLYGON((0.000 100.000 0.000,100.000 100.000 100.000,0.000 100.000 100.000,0.000 100.000 0.000))",
      "SRID=3125;POLYGON((0.000 100.000 0.000,100.000 100.000 0.000,100.000 100.000 100.000,0.000 100.000 0.000))",
      "SRID=3125;POLYGON((100.000 100.000 0.000,100.000 0.000 0.000,100.000 100.000 100.000,100.000 100.000 0.000))",
      "SRID=3125;POLYGON((100.000 0.000 0.000,100.000 0.000 100.000,100.000 100.000 100.000,100.000 0.000 0.000))",
      "SRID=3125;POLYGON((100.000 0.000 0.000,0.000 0.000 0.000,100.000 0.000 100.000,100.000 0.000 0.000))",
      "SRID=3125;POLYGON((0.000 0.000 0.000,0.000 0.000 100.000,100.000 0.000 100.000,0.000 0.000 0.000))",
      "SRID=3125;POLYGON((0.000 100.000 0.000,0.000 0.000 0.000,100.000 0.000 0.000,0.000 100.000 0.000))",
      "SRID=3125;POLYGON((0.000 100.000 0.000,100.000 0.000 0.000,100.000 100.000 0.000,0.000 100.000 0.000))",
      "SRID=3125;POLYGON((100.000 0.000 100.000,0.000 0.000 100.000,0.000 100.000 100.000,100.000 0.000 100.000))",
      "SRID=3125;POLYGON((100.000 100.000 100.000,100.000 0.000 100.000,0.000 100.000 100.000,100.000 100.000 100.000))")
  )
  expect_equal(
    round(testEWKT$slope_angle, digits = 2),
    c(rep(1.57, times = 8), 0, 0, 0, 0)
  )
})

dtm_fle <- system.file("testdata", "eng.dtm", package = "tmctools")
testDF <- readDTM(dtm_fle)
testEWKT <- readDTM(dtm_fle, srid = "3125")

test_that("readDTM works", {
  expect_equal(round(testDF$edge_length, digits = 2), 381.39)
  expect_equal(
    testDF$polygon,
    "POLYGON Z ((586904.927 1054364.450 19.778,586638.644 1054111.659 24.311,586641.856 1054088.365 24.919,586904.927 1054364.450 19.778))"
  )
  expect_equal(round(testEWKT$edge_length, digits = 2), 381.39)
  expect_equal(
    testEWKT$polygon,
    "SRID=3125;POLYGON((586904.927 1054364.450 19.778,586638.644 1054111.659 24.311,586641.856 1054088.365 24.919,586904.927 1054364.450 19.778))"
  )
})

rm(list = ls())
