library(tmctools)

str <- system.file("testdata", "box.str", package = "tmctools")
dtm <- system.file("testdata", "box.dtm", package = "tmctools")
file.copy(str, "test.str")
file.copy(dtm, "test.dtm")
testDF <- readDTM("test.dtm")
testEWKT <- readDTM("test.dtm", srid = "3125")

test_that("readDTM works", {
  expect_equal(round(testDF$edge_length, digits = 2), rep(141.42, times = 12))
  expect_equal(
    testDF$polygon,
    c("POLYGON Z ((0.000000 0.000000 0.000000,0.000000 100.000000 100.000000,0.000000 0.000000 100.000000,0.000000 0.000000 0.000000))",
      "POLYGON Z ((0.000000 0.000000 0.000000,0.000000 100.000000 0.000000,0.000000 100.000000 100.000000,0.000000 0.000000 0.000000))",
      "POLYGON Z ((0.000000 100.000000 0.000000,100.000000 100.000000 100.000000,0.000000 100.000000 100.000000,0.000000 100.000000 0.000000))",
      "POLYGON Z ((0.000000 100.000000 0.000000,100.000000 100.000000 0.000000,100.000000 100.000000 100.000000,0.000000 100.000000 0.000000))",
      "POLYGON Z ((100.000000 100.000000 0.000000,100.000000 0.000000 0.000000,100.000000 100.000000 100.000000,100.000000 100.000000 0.000000))",
      "POLYGON Z ((100.000000 0.000000 0.000000,100.000000 0.000000 100.000000,100.000000 100.000000 100.000000,100.000000 0.000000 0.000000))",
      "POLYGON Z ((100.000000 0.000000 0.000000,0.000000 0.000000 0.000000,100.000000 0.000000 100.000000,100.000000 0.000000 0.000000))",
      "POLYGON Z ((0.000000 0.000000 0.000000,0.000000 0.000000 100.000000,100.000000 0.000000 100.000000,0.000000 0.000000 0.000000))",
      "POLYGON Z ((0.000000 100.000000 0.000000,0.000000 0.000000 0.000000,100.000000 0.000000 0.000000,0.000000 100.000000 0.000000))",
      "POLYGON Z ((0.000000 100.000000 0.000000,100.000000 0.000000 0.000000,100.000000 100.000000 0.000000,0.000000 100.000000 0.000000))",
      "POLYGON Z ((100.000000 0.000000 100.000000,0.000000 0.000000 100.000000,0.000000 100.000000 100.000000,100.000000 0.000000 100.000000))",
      "POLYGON Z ((100.000000 100.000000 100.000000,100.000000 0.000000 100.000000,0.000000 100.000000 100.000000,100.000000 100.000000 100.000000))")
  )
  expect_equal(round(testEWKT$edge_length, digits = 2), rep(141.42, times = 12))
  expect_equal(
    testEWKT$polygon,
    c("SRID=3125;POLYGON((0.000000 0.000000 0.000000,0.000000 100.000000 100.000000,0.000000 0.000000 100.000000,0.000000 0.000000 0.000000))",
      "SRID=3125;POLYGON((0.000000 0.000000 0.000000,0.000000 100.000000 0.000000,0.000000 100.000000 100.000000,0.000000 0.000000 0.000000))",
      "SRID=3125;POLYGON((0.000000 100.000000 0.000000,100.000000 100.000000 100.000000,0.000000 100.000000 100.000000,0.000000 100.000000 0.000000))",
      "SRID=3125;POLYGON((0.000000 100.000000 0.000000,100.000000 100.000000 0.000000,100.000000 100.000000 100.000000,0.000000 100.000000 0.000000))",
      "SRID=3125;POLYGON((100.000000 100.000000 0.000000,100.000000 0.000000 0.000000,100.000000 100.000000 100.000000,100.000000 100.000000 0.000000))",
      "SRID=3125;POLYGON((100.000000 0.000000 0.000000,100.000000 0.000000 100.000000,100.000000 100.000000 100.000000,100.000000 0.000000 0.000000))",
      "SRID=3125;POLYGON((100.000000 0.000000 0.000000,0.000000 0.000000 0.000000,100.000000 0.000000 100.000000,100.000000 0.000000 0.000000))",
      "SRID=3125;POLYGON((0.000000 0.000000 0.000000,0.000000 0.000000 100.000000,100.000000 0.000000 100.000000,0.000000 0.000000 0.000000))",
      "SRID=3125;POLYGON((0.000000 100.000000 0.000000,0.000000 0.000000 0.000000,100.000000 0.000000 0.000000,0.000000 100.000000 0.000000))",
      "SRID=3125;POLYGON((0.000000 100.000000 0.000000,100.000000 0.000000 0.000000,100.000000 100.000000 0.000000,0.000000 100.000000 0.000000))",
      "SRID=3125;POLYGON((100.000000 0.000000 100.000000,0.000000 0.000000 100.000000,0.000000 100.000000 100.000000,100.000000 0.000000 100.000000))",
      "SRID=3125;POLYGON((100.000000 100.000000 100.000000,100.000000 0.000000 100.000000,0.000000 100.000000 100.000000,100.000000 100.000000 100.000000))")
  )
})

file.remove("test.str", "test.dtm")
rm(list = ls())
