library(tmctools)

dtm_fle <- system.file("testdata", "box.dtm", package = "tmctools")
testDF <- readDTM(dtm_fle)
testEWKT <- readDTM(dtm_fle, srid = "3125")

test_that("readDTM works", {
  expect_equal(round(testDF$edge_length, digits = 2), rep(141.42, times = 12))
  expect_equal(
    testDF$polygon,
    c("POLYGON Z ((0.000000 0.000000 0.000000,0.000000 100.000000 100.000000,0.000000 0.000000 100.000000,0.000000 0.000000 0.000000))",
      "POLYGON Z ((0.000000 0.000000 0.000000,0.000000 100.000000 0.000000,0.000000 100.000000 100.000000,0.000000 0.000000 0.000000))",
      "POLYGON Z ((0.000000 100.000000 0.000000,100.000000 100.000000 100.000000,0.000000 100.000000 100.000000,0.000000 100.000000 0.000000))",
      "POLYGON Z ((0.000000 100.000000 0.000000,100.000000 100.000000 0.000000,100.000000 100.000000 100.000000,0.000000 100.000000 0.000000))",
      "POLYGON Z ((100.000000 100.000000 0.000000,100.000000 0.000000 0.000000,100.000000 100.000000 100.000000,100.000000 100.000000 0.000000))",
      "POLYGON Z ((100.000000 0.000000 0.000000,100.000000 0.000000 100.000000,100.000000 100.000000 100.000000,100.000000 0.000000 0.000000))",
      "POLYGON Z ((100.000000 0.000000 0.000000,0.000000 0.000000 0.000000,100.000000 0.000000 100.000000,100.000000 0.000000 0.000000))",
      "POLYGON Z ((0.000000 0.000000 0.000000,0.000000 0.000000 100.000000,100.000000 0.000000 100.000000,0.000000 0.000000 0.000000))",
      "POLYGON Z ((0.000000 100.000000 0.000000,0.000000 0.000000 0.000000,100.000000 0.000000 0.000000,0.000000 100.000000 0.000000))",
      "POLYGON Z ((0.000000 100.000000 0.000000,100.000000 0.000000 0.000000,100.000000 100.000000 0.000000,0.000000 100.000000 0.000000))",
      "POLYGON Z ((100.000000 0.000000 100.000000,0.000000 0.000000 100.000000,0.000000 100.000000 100.000000,100.000000 0.000000 100.000000))",
      "POLYGON Z ((100.000000 100.000000 100.000000,100.000000 0.000000 100.000000,0.000000 100.000000 100.000000,100.000000 100.000000 100.000000))")
  )
  expect_equal(round(testEWKT$edge_length, digits = 2), rep(141.42, times = 12))
  expect_equal(
    testEWKT$polygon,
    c("SRID=3125;POLYGON((0.000000 0.000000 0.000000,0.000000 100.000000 100.000000,0.000000 0.000000 100.000000,0.000000 0.000000 0.000000))",
      "SRID=3125;POLYGON((0.000000 0.000000 0.000000,0.000000 100.000000 0.000000,0.000000 100.000000 100.000000,0.000000 0.000000 0.000000))",
      "SRID=3125;POLYGON((0.000000 100.000000 0.000000,100.000000 100.000000 100.000000,0.000000 100.000000 100.000000,0.000000 100.000000 0.000000))",
      "SRID=3125;POLYGON((0.000000 100.000000 0.000000,100.000000 100.000000 0.000000,100.000000 100.000000 100.000000,0.000000 100.000000 0.000000))",
      "SRID=3125;POLYGON((100.000000 100.000000 0.000000,100.000000 0.000000 0.000000,100.000000 100.000000 100.000000,100.000000 100.000000 0.000000))",
      "SRID=3125;POLYGON((100.000000 0.000000 0.000000,100.000000 0.000000 100.000000,100.000000 100.000000 100.000000,100.000000 0.000000 0.000000))",
      "SRID=3125;POLYGON((100.000000 0.000000 0.000000,0.000000 0.000000 0.000000,100.000000 0.000000 100.000000,100.000000 0.000000 0.000000))",
      "SRID=3125;POLYGON((0.000000 0.000000 0.000000,0.000000 0.000000 100.000000,100.000000 0.000000 100.000000,0.000000 0.000000 0.000000))",
      "SRID=3125;POLYGON((0.000000 100.000000 0.000000,0.000000 0.000000 0.000000,100.000000 0.000000 0.000000,0.000000 100.000000 0.000000))",
      "SRID=3125;POLYGON((0.000000 100.000000 0.000000,100.000000 0.000000 0.000000,100.000000 100.000000 0.000000,0.000000 100.000000 0.000000))",
      "SRID=3125;POLYGON((100.000000 0.000000 100.000000,0.000000 0.000000 100.000000,0.000000 100.000000 100.000000,100.000000 0.000000 100.000000))",
      "SRID=3125;POLYGON((100.000000 100.000000 100.000000,100.000000 0.000000 100.000000,0.000000 100.000000 100.000000,100.000000 100.000000 100.000000))")
  )
})

dtm_fle <- system.file("testdata", "eng.dtm", package = "tmctools")
testDF <- readDTM(dtm_fle)
testEWKT <- readDTM(dtm_fle, srid = "3125")

test_that("readDTM works", {
  expect_equal(round(testDF$edge_length, digits = 2), 381.39)
  expect_equal(
    testDF$polygon,
    "POLYGON Z ((586904.927000 1054364.450000 19.778000,586638.644000 1054111.659000 24.311000,586641.856000 1054088.365000 24.919000,586904.927000 1054364.450000 19.778000))"
  )
  expect_equal(round(testEWKT$edge_length, digits = 2), 381.39)
  expect_equal(
    testEWKT$polygon,
    "SRID=3125;POLYGON((586904.927000 1054364.450000 19.778000,586638.644000 1054111.659000 24.311000,586641.856000 1054088.365000 24.919000,586904.927000 1054364.450000 19.778000))"
  )
})

rm(list = ls())
